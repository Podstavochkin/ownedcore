"""
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏"
–ê–≤—Ç–æ—Ä: CryptoProject v0.01
–û–ø–∏—Å–∞–Ω–∏–µ: –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from main import get_24h_data, get_current_price, analyze_royal_levels_strategy
from royal_levels_strategy import RoyalLevelsStrategy

def test_strategy_components():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –°–¢–†–ê–¢–ï–ì–ò–ò")
    print("="*60)
    
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    strategy = RoyalLevelsStrategy(deposit=10000)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫—Ä—É–≥–ª—ã—Ö —á–∏—Å–µ–ª
    test_prices = [29500, 29501, 30000, 30001, 5000, 5001, 10000, 10001]
    print("\nüî¢ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ '–∫—Ä—É–≥–ª—ã–µ —á–∏—Å–ª–∞':")
    for price in test_prices:
        is_round = strategy.is_round_number(price)
        print(f"  ${price:,.2f} -> {'‚úÖ –ö—Ä—É–≥–ª–æ–µ' if is_round else '‚ùå –ù–µ –∫—Ä—É–≥–ª–æ–µ'}")
    
    print("\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ")

def test_strategy_analysis():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏"""
    print("\nüéØ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–û–õ–ù–û–ì–û –ê–ù–ê–õ–ò–ó–ê –°–¢–†–ê–¢–ï–ì–ò–ò")
    print("="*60)
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    print("üìä –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –±–∏—Ä–∂–∏...")
    data = get_24h_data('BTC/USDT')
    
    if not data:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
    print(f"‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ: {list(data.keys())}")
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
    strategy_results = analyze_royal_levels_strategy(data, 'BTC/USDT', deposit=10000)
    
    if strategy_results:
        print("\nüìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê:")
        print(f"  ‚Ä¢ –ù–∞–π–¥–µ–Ω–æ –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π: {len(strategy_results['royal_levels'])}")
        print(f"  ‚Ä¢ –¢–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤: {len(strategy_results['signals'])}")
        print(f"  ‚Ä¢ –§–∏–ª—å—Ç—Ä —Ç—Ä–µ–Ω–¥–∞: {strategy_results['trend_filter']}")
        print(f"  ‚Ä¢ –ì–æ—Ç–æ–≤ –∫ —Ç–æ—Ä–≥–æ–≤–ª–µ: {'‚úÖ –î–ê' if strategy_results['can_trade'] else '‚ùå –ù–ï–¢'}")
    else:
        print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏")

def test_multiple_symbols():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–∏–º–≤–æ–ª–∞—Ö"""
    print("\nüîÑ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ù–ê –†–ê–ó–ù–´–• –°–ò–ú–í–û–õ–ê–•")
    print("="*60)
    
    symbols = ['BTC/USDT', 'ETH/USDT']
    
    for symbol in symbols:
        print(f"\nüìä –ê–Ω–∞–ª–∏–∑ {symbol}...")
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        data = get_24h_data(symbol)
        
        if not data:
            print(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è {symbol}")
            continue
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
        strategy_results = analyze_royal_levels_strategy(data, symbol, deposit=10000)
        
        if strategy_results:
            print(f"‚úÖ {symbol}: {len(strategy_results['signals'])} —Å–∏–≥–Ω–∞–ª–æ–≤")
        else:
            print(f"‚ùå {symbol}: –æ—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –°–¢–†–ê–¢–ï–ì–ò–ò '–ö–û–†–û–õ–ï–í–°–ö–ò–ï –£–†–û–í–ù–ò'")
    print("="*60)
    
    try:
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        test_strategy_components()
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
        test_strategy_analysis()
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö
        test_multiple_symbols()
        
        print("\nüéâ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û!")
        
    except Exception as e:
        print(f"\n‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    main() 