# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Ü–µ–Ω–æ–≤—ã—Ö —Ñ–∏–≥—É—Ä (Chart Patterns)

## üìä –û–±–∑–æ—Ä

–¶–µ–Ω–æ–≤—ã–µ —Ñ–∏–≥—É—Ä—ã (chart patterns) ‚Äî —ç—Ç–æ –∫—Ä—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–≤–µ—á–µ–π –∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏–ª–∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç —Ç—Ä–µ–Ω–¥–∞. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å–≤–µ—á–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (1-3 —Å–≤–µ—á–∏), —Ü–µ–Ω–æ–≤—ã–µ —Ñ–∏–≥—É—Ä—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –¥–µ—Å—è—Ç–∫–æ–≤ –∏–ª–∏ —Å–æ—Ç–µ–Ω —Å–≤–µ—á–µ–π.

**–ò—Å—Ç–æ—á–Ω–∏–∫:** [–°–∫–∞–ª—å–ø–∏–Ω–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã](https://livetouring.org/skalping-strategii-kriptovaljuty-s-primerami/)

---

## üéØ 12 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ü–µ–Ω–æ–≤—ã—Ö —Ñ–∏–≥—É—Ä

### –†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã (Reversal Patterns):

1. **–ì–æ–ª–æ–≤–∞ –∏ –ø–ª–µ—á–∏ (Head and Shoulders)** üî¥
   - –¢—Ä–∏ –ø–∏–∫–∞: —Å—Ä–µ–¥–Ω–∏–π –≤—ã—à–µ –¥–≤—É—Ö –±–æ–∫–æ–≤—ã—Ö
   - –†–∞–∑–≤–æ—Ä–æ—Ç –≤–Ω–∏–∑ –ø–æ—Å–ª–µ –ø—Ä–æ–±–æ—è –ª–∏–Ω–∏–∏ —à–µ–∏
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è

2. **–î–≤–æ–π–Ω–∞—è –≤–µ—Ä—à–∏–Ω–∞ (Double Top)** üî¥
   - –î–≤–∞ –ø–∏–∫–∞ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ
   - –†–∞–∑–≤–æ—Ä–æ—Ç –≤–Ω–∏–∑ –ø–æ—Å–ª–µ –ø—Ä–æ–±–æ—è
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è

3. **–î–≤–æ–π–Ω–æ–µ –¥–Ω–æ (Double Bottom)** üü¢
   - –î–≤–∞ –º–∏–Ω–∏–º—É–º–∞ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ
   - –†–∞–∑–≤–æ—Ä–æ—Ç –≤–≤–µ—Ä—Ö –ø–æ—Å–ª–µ –ø—Ä–æ–±–æ—è
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è

4. **–í–æ—Å—Ö–æ–¥—è—â–∏–π –∫–ª–∏–Ω (Rising Wedge)** üî¥
   - –°—Ö–æ–¥—è—â–∏–µ—Å—è –ª–∏–Ω–∏–∏, –æ–±–µ –≤–æ—Å—Ö–æ–¥—è—â–∏–µ
   - –†–∞–∑–≤–æ—Ä–æ—Ç –≤–Ω–∏–∑
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: —Å—Ä–µ–¥–Ω—è—è

5. **–ù–∏—Å—Ö–æ–¥—è—â–∏–π –∫–ª–∏–Ω (Falling Wedge)** üü¢
   - –°—Ö–æ–¥—è—â–∏–µ—Å—è –ª–∏–Ω–∏–∏, –æ–±–µ –Ω–∏—Å—Ö–æ–¥—è—â–∏–µ
   - –†–∞–∑–≤–æ—Ä–æ—Ç –≤–≤–µ—Ä—Ö
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: —Å—Ä–µ–¥–Ω—è—è

### –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ (Continuation Patterns):

6. **–§–ª–∞–≥ (Flag)** üìàüìâ
   - –†–µ–∑–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (—Ñ–ª–∞–≥—à—Ç–æ–∫) + –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è
   - –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ñ–ª–∞–≥—à—Ç–æ–∫–∞
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è

7. **–í—ã–º–ø–µ–ª (Pennant)** üìàüìâ
   - –†–µ–∑–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ + —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫
   - –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è

8. **–ö–∞–Ω–∞–ª (Channel)** üìàüìâ
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
   - –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ –≤–Ω—É—Ç—Ä–∏ –∫–∞–Ω–∞–ª–∞
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: —Å—Ä–µ–¥–Ω—è—è

9. **–í–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (Ascending Triangle)** üü¢
   - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ + –≤–æ—Å—Ö–æ–¥—è—â–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
   - –ü—Ä–æ–±–æ–π –≤–≤–µ—Ä—Ö
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è

10. **–ù–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (Descending Triangle)** üî¥
    - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ + –Ω–∏—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ
    - –ü—Ä–æ–±–æ–π –≤–Ω–∏–∑
    - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –≤—ã—Å–æ–∫–∞—è

### –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è (Consolidation Patterns):

11. **–°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (Symmetrical Triangle)** ‚ö™
    - –°—Ö–æ–¥—è—â–∏–µ—Å—è –ª–∏–Ω–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
    - –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: –Ω–∏–∑–∫–∞—è (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)

12. **–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (Rectangle)** ‚ö™
    - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
    - –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–±–æ–µ–º
    - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å: —Å—Ä–µ–¥–Ω—è—è

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (ChartPattern)

```python
class ChartPattern(Base):
    """–ú–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ü–µ–Ω–æ–≤—ã—Ö —Ñ–∏–≥—É—Ä"""
    __tablename__ = 'chart_patterns'
    
    id = Column(Integer, primary_key=True, index=True)
    symbol = Column(String(20), nullable=False, index=True)
    timeframe = Column(String(10), nullable=False, index=True)
    pattern_type = Column(String(50), nullable=False)  # head_and_shoulders, flag, etc.
    pattern_category = Column(String(20), nullable=False)  # reversal, continuation, consolidation
    direction = Column(String(10), nullable=False)  # bullish, bearish, neutral
    reliability = Column(Float, default=0.5)  # 0.0-1.0
    
    # –ì–µ–æ–º–µ—Ç—Ä–∏—è —Ñ–∏–≥—É—Ä—ã
    start_time = Column(DateTime(timezone=True), nullable=False)
    end_time = Column(DateTime(timezone=True), nullable=False)
    confirmation_time = Column(DateTime(timezone=True))  # –í—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–ø—Ä–æ–±–æ–π)
    
    # –ö–ª—é—á–µ–≤—ã–µ —É—Ä–æ–≤–Ω–∏ —Ñ–∏–≥—É—Ä—ã
    support_level = Column(Float)  # –£—Ä–æ–≤–µ–Ω—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏/–Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞
    resistance_level = Column(Float)  # –£—Ä–æ–≤–µ–Ω—å —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è/–≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞
    neckline = Column(Float)  # –î–ª—è Head and Shoulders, Double Top/Bottom
    target_price = Column(Float)  # –¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–±–æ—è
    
    # –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ñ–∏–≥—É—Ä—ã
    pattern_height = Column(Float)  # –í—ã—Å–æ—Ç–∞ —Ñ–∏–≥—É—Ä—ã –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    pattern_width = Column(Integer)  # –®–∏—Ä–∏–Ω–∞ –≤ —Å–≤–µ—á–∞—Ö
    volume_confirmation = Column(Boolean, default=False)  # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–æ–º
    
    # –°—Ç–∞—Ç—É—Å
    is_active = Column(Boolean, default=True, index=True)
    is_confirmed = Column(Boolean, default=False)  # –ü—Ä–æ–±–æ–π –ø—Ä–æ–∏–∑–æ—à–µ–ª?
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    candles_count = Column(Integer)  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π –≤ —Ñ–∏–≥—É—Ä–µ
    pattern_data = Column(JSON)  # –î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ—á–∫–∏, –ª–∏–Ω–∏–∏ –∏ —Ç.–¥.)
    
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
```

### 2. –î–µ—Ç–µ–∫—Ç–æ—Ä —Ü–µ–Ω–æ–≤—ã—Ö —Ñ–∏–≥—É—Ä (ChartPatternDetector)

```python
class ChartPatternDetector:
    """–î–µ—Ç–µ–∫—Ç–æ—Ä —Ü–µ–Ω–æ–≤—ã—Ö —Ñ–∏–≥—É—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è"""
    
    def __init__(self):
        self.min_pattern_candles = 20  # –ú–∏–Ω–∏–º—É–º —Å–≤–µ—á–µ–π –¥–ª—è —Ñ–∏–≥—É—Ä—ã
        self.max_pattern_candles = 200  # –ú–∞–∫—Å–∏–º—É–º —Å–≤–µ—á–µ–π
        self.tolerance = 0.002  # 0.2% —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –¥–ª—è —É—Ä–æ–≤–Ω–µ–π
        
    def detect_all_patterns(self, candles: List[Dict], symbol: str, timeframe: str) -> List[Dict]:
        """–î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã"""
        patterns = []
        
        # 1. –†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã
        patterns.extend(self.detect_head_and_shoulders(candles, symbol, timeframe))
        patterns.extend(self.detect_double_top(candles, symbol, timeframe))
        patterns.extend(self.detect_double_bottom(candles, symbol, timeframe))
        patterns.extend(self.detect_wedges(candles, symbol, timeframe))
        
        # 2. –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞
        patterns.extend(self.detect_flags(candles, symbol, timeframe))
        patterns.extend(self.detect_pennants(candles, symbol, timeframe))
        patterns.extend(self.detect_channels(candles, symbol, timeframe))
        patterns.extend(self.detect_triangles(candles, symbol, timeframe))
        
        # 3. –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è
        patterns.extend(self.detect_rectangles(candles, symbol, timeframe))
        
        return patterns
    
    def detect_head_and_shoulders(self, candles, symbol, timeframe):
        """–î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç —Ñ–∏–≥—É—Ä—É '–ì–æ–ª–æ–≤–∞ –∏ –ø–ª–µ—á–∏'"""
        # –ê–ª–≥–æ—Ä–∏—Ç–º:
        # 1. –ù–∞–π—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞–∫—Å–∏–º—É–º—ã
        # 2. –ù–∞–π—Ç–∏ —Ç—Ä–∏ –ø–∏–∫–∞: —Å—Ä–µ–¥–Ω–∏–π –≤—ã—à–µ –¥–≤—É—Ö –±–æ–∫–æ–≤—ã—Ö
        # 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–º–º–µ—Ç—Ä–∏—é
        # 4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–∏–Ω–∏—é —à–µ–∏
        # 5. –í—ã—á–∏—Å–ª–∏—Ç—å —Ü–µ–ª–µ–≤—É—é —Ü–µ–Ω—É
        pass
    
    def detect_flags(self, candles, symbol, timeframe):
        """–î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç —Ñ–∏–≥—É—Ä—É '–§–ª–∞–≥'"""
        # –ê–ª–≥–æ—Ä–∏—Ç–º:
        # 1. –ù–∞–π—Ç–∏ —Ä–µ–∑–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (—Ñ–ª–∞–≥—à—Ç–æ–∫)
        # 2. –ù–∞–π—Ç–∏ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ –¥–≤–∏–∂–µ–Ω–∏—è
        # 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –ª–∏–Ω–∏–π —Ñ–ª–∞–≥–∞
        # 4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–æ—è
        pass
    
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–µ—Ç–µ–∫—Ü–∏–∏
```

### 3. –ê–ª–≥–æ—Ä–∏—Ç–º—ã –¥–µ—Ç–µ–∫—Ü–∏–∏

#### 3.1. –ì–æ–ª–æ–≤–∞ –∏ –ø–ª–µ—á–∏ (Head and Shoulders)

```python
def detect_head_and_shoulders(candles):
    """
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –ù–∞–π—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–∞–∫—Å–∏–º—É–º—ã (–ø–∏–∫–∏)
    2. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –≤—ã—Å–æ—Ç–µ (–º–∏–Ω–∏–º—É–º 1% –æ—Ç —Ü–µ–Ω—ã)
    3. –ù–∞–π—Ç–∏ —Ç—Ä–∏ –ø–∏–∫–∞: –ª–µ–≤–æ–µ –ø–ª–µ—á–æ, –≥–æ–ª–æ–≤–∞, –ø—Ä–∞–≤–æ–µ –ø–ª–µ—á–æ
    4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –≥–æ–ª–æ–≤–∞ > –æ–±–∞ –ø–ª–µ—á–∞
    5. –ù–∞–π—Ç–∏ –ª–∏–Ω–∏—é —à–µ–∏ (–º–∏–Ω–∏–º—É–º—ã –º–µ–∂–¥—É –ø–∏–∫–∞–º–∏)
    6. –í—ã—á–∏—Å–ª–∏—Ç—å —Ü–µ–ª–µ–≤—É—é —Ü–µ–Ω—É: neckline - (head - neckline)
    """
    peaks = find_local_maxima(candles, min_height_pct=0.01)
    
    for i in range(len(peaks) - 2):
        left_shoulder = peaks[i]
        head = peaks[i + 1]
        right_shoulder = peaks[i + 2]
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π
        if head['price'] > left_shoulder['price'] and \
           head['price'] > right_shoulder['price'] and \
           abs(left_shoulder['price'] - right_shoulder['price']) / head['price'] < 0.01:
            
            # –ù–∞–π—Ç–∏ –ª–∏–Ω–∏—é —à–µ–∏
            neckline = find_neckline(candles, left_shoulder, head, right_shoulder)
            
            # –í—ã—á–∏—Å–ª–∏—Ç—å —Ü–µ–ª–µ–≤—É—é —Ü–µ–Ω—É
            pattern_height = head['price'] - neckline
            target_price = neckline - pattern_height
            
            return {
                'pattern_type': 'head_and_shoulders',
                'category': 'reversal',
                'direction': 'bearish',
                'reliability': calculate_reliability(...),
                'support_level': neckline,
                'resistance_level': head['price'],
                'neckline': neckline,
                'target_price': target_price,
                'start_time': left_shoulder['time'],
                'end_time': right_shoulder['time']
            }
```

#### 3.2. –§–ª–∞–≥ (Flag)

```python
def detect_flags(candles):
    """
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –ù–∞–π—Ç–∏ —Ä–µ–∑–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ (—Ñ–ª–∞–≥—à—Ç–æ–∫) - –º–∏–Ω–∏–º—É–º 2% –∑–∞ 5-20 —Å–≤–µ—á–µ–π
    2. –ù–∞–π—Ç–∏ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ –¥–≤–∏–∂–µ–Ω–∏—è (5-30 —Å–≤–µ—á–µ–π)
    3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –ª–∏–Ω–∏–π –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏
    4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –µ—Å–ª–∏ —Ñ–ª–∞–≥—à—Ç–æ–∫ –≤–≤–µ—Ä—Ö ‚Üí –ø—Ä–æ–±–æ–π –≤–≤–µ—Ä—Ö
    """
    # –ù–∞–π—Ç–∏ —Ä–µ–∑–∫–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
    strong_moves = find_strong_moves(candles, min_pct=0.02, min_candles=5, max_candles=20)
    
    for move in strong_moves:
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—é –ø–æ—Å–ª–µ –¥–≤–∏–∂–µ–Ω–∏—è
        consolidation = find_consolidation(candles, after=move['end_index'], max_candles=30)
        
        if consolidation and is_parallel(consolidation['support'], consolidation['resistance']):
            return {
                'pattern_type': 'flag',
                'category': 'continuation',
                'direction': 'bullish' if move['direction'] == 'up' else 'bearish',
                'reliability': 0.75,
                'support_level': consolidation['support'],
                'resistance_level': consolidation['resistance'],
                'target_price': calculate_flag_target(move, consolidation),
                'start_time': move['start_time'],
                'end_time': consolidation['end_time']
            }
```

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Elder Screens

```python
async def check_elder_screens(..., chart_patterns: List[ChartPattern] = None):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ Elder Screens —Å —É—á–µ—Ç–æ–º —Ü–µ–Ω–æ–≤—ã—Ö —Ñ–∏–≥—É—Ä"""
    
    # –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã
    relevant_patterns = get_patterns_near_level(chart_patterns, level_price, current_price)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö —Ñ–∏–≥—É—Ä
    if has_contradictory_pattern(relevant_patterns, signal_type):
        return False, {"reason": "–¶–µ–Ω–æ–≤–∞—è —Ñ–∏–≥—É—Ä–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç —Å–∏–≥–Ω–∞–ª—É"}
    
    # –ë–æ–Ω—É—Å –∫ score –¥–ª—è —Ñ–∏–≥—É—Ä –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞
    continuation_bonus = calculate_continuation_bonus(relevant_patterns, signal_type)
    adjusted_score = level_score + continuation_bonus
    
    # –°–º—è–≥—á–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π Screen 2 –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–π —Ñ–∏–≥—É—Ä–µ
    confirmed_pattern = get_confirmed_pattern(relevant_patterns, signal_type)
    if confirmed_pattern and confirmed_pattern.reliability > 0.7:
        # –°–º—è–≥—á–∞–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–∞–º
        rsi_threshold = 75 if signal_type == 'LONG' else 25
        macd_tolerance = 0.01
```

### 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π Take Profit

```python
def calculate_tp_with_pattern(signal, chart_pattern):
    """–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–µ–ª–µ–≤—É—é —Ü–µ–Ω—É —Ñ–∏–≥—É—Ä—ã –¥–ª—è TP"""
    fixed_tp = signal.entry_price * (1 + 0.015)  # 1.5% —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
    
    if chart_pattern and chart_pattern.target_price:
        pattern_tp = chart_pattern.target_price
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω TP –µ—Å–ª–∏ –æ–Ω –±–æ–ª—å—à–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏ < 5%
        if pattern_tp > fixed_tp:
            tp_percent = (pattern_tp - signal.entry_price) / signal.entry_price
            if tp_percent < 0.05:  # –ù–µ –±–æ–ª—å—à–µ 5%
                return pattern_tp
    
    return fixed_tp
```

### 3. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

```python
def has_contradictory_pattern(patterns, signal_type):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö —Ñ–∏–≥—É—Ä"""
    for pattern in patterns:
        if pattern.is_confirmed:
            # –†–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã
            if pattern.pattern_category == 'reversal':
                if signal_type == 'LONG' and pattern.direction == 'bearish':
                    return True
                if signal_type == 'SHORT' and pattern.direction == 'bullish':
                    return True
            
            # –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞
            if pattern.pattern_category == 'continuation':
                if signal_type == 'LONG' and pattern.direction == 'bearish':
                    return True
                if signal_type == 'SHORT' and pattern.direction == 'bullish':
                    return True
    
    return False
```

---

## üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∞—Ö

### 1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä

- **–õ–∏–Ω–∏–∏ —Ñ–∏–≥—É—Ä—ã**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞, —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ, –ª–∏–Ω–∏—è —à–µ–∏
- **–ó–∞–∫—Ä–∞—à–µ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å**: –∑–æ–Ω–∞ —Ñ–∏–≥—É—Ä—ã
- **–ú–∞—Ä–∫–µ—Ä—ã**: —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞, —Ü–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞
- **–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏**: —Ç–∏–ø —Ñ–∏–≥—É—Ä—ã, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ charts.html

```javascript
// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
function renderChartPatterns(patterns) {
    patterns.forEach(pattern => {
        // –†–∏—Å—É–µ–º –ª–∏–Ω–∏–∏ —Ñ–∏–≥—É—Ä—ã
        if (pattern.support_level) {
            drawSupportLine(pattern.support_level, pattern.start_time, pattern.end_time);
        }
        if (pattern.resistance_level) {
            drawResistanceLine(pattern.resistance_level, pattern.start_time, pattern.end_time);
        }
        if (pattern.neckline) {
            drawNeckline(pattern.neckline, pattern.start_time, pattern.end_time);
        }
        
        // –ó–∞–∫—Ä–∞—à–∏–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å —Ñ–∏–≥—É—Ä—ã
        fillPatternArea(pattern);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
        addPatternMarkers(pattern);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é
        addPatternAnnotation(pattern);
    });
}
```

---

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1-2 –¥–Ω—è)
- [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `ChartPattern` –≤ –ë–î
- [ ] –°–æ–∑–¥–∞—Ç—å Alembic –º–∏–≥—Ä–∞—Ü–∏—é
- [ ] –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `ChartPatternDetector`

### –≠—Ç–∞–ø 2: –î–µ—Ç–µ–∫—Ü–∏—è —Ñ–∏–≥—É—Ä (3-5 –¥–Ω–µ–π)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é —Ä–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã—Ö —Ñ–∏–≥—É—Ä (Head and Shoulders, Double Top/Bottom, Wedges)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é —Ñ–∏–≥—É—Ä –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è (Flag, Pennant, Channel, Triangles)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏ (Rectangle, Symmetrical Triangle)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —Ñ–∏–≥—É—Ä

### –≠—Ç–∞–ø 3: Celery –∑–∞–¥–∞—á–∏ (1 –¥–µ–Ω—å)
- [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É `detect_chart_patterns_periodic`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `celery_app.py`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç –¥–ª—è 1h, –∫–∞–∂–¥—ã–π —á–∞—Å –¥–ª—è 4h)

### –≠—Ç–∞–ø 4: API –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (2-3 –¥–Ω—è)
- [ ] –î–æ–±–∞–≤–∏—Ç—å API endpoint `/api/chart-patterns`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `charts.html`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Ñ–∏–≥—É—Ä –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é (2-3 –¥–Ω—è)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `check_elder_screens()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π TP –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–≥—É—Ä
- [ ] –î–æ–±–∞–≤–∏—Ç—å –±–æ–Ω—É—Å –∫ score

### –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2-3 –¥–Ω—è)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–µ—Ç–µ–∫—Ü–∏–∏
- [ ] –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–æ–≤:
- ‚úÖ **–ú–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤** ‚Äî —Ñ–∏–≥—É—Ä—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã
- ‚úÖ **–õ—É—á—à–∏–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞** ‚Äî —Ñ–∏–≥—É—Ä—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã
- ‚úÖ **–ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π TP** ‚Äî —Ü–µ–ª–µ–≤—ã–µ —Ü–µ–Ω—ã —Ñ–∏–≥—É—Ä
- ‚úÖ **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤** ‚Äî —Ä–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—Ç –æ —Å–º–µ–Ω–µ —Ç—Ä–µ–Ω–¥–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- **Win Rate —Å —Ñ–∏–≥—É—Ä–∞–º–∏** vs **–±–µ–∑ —Ñ–∏–≥—É—Ä**
- **Average P&L** —Å —Ñ–∏–≥—É—Ä–∞–º–∏ vs –±–µ–∑ —Ñ–∏–≥—É—Ä
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤** –∏–∑-–∑–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã—Ö —Ñ–∏–≥—É—Ä
- **–¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π** —Ä–∞–∑–≤–æ—Ä–æ—Ç–Ω—ã—Ö —Ñ–∏–≥—É—Ä

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–¶–µ–Ω–æ–≤—ã–µ —Ñ–∏–≥—É—Ä—ã —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –º–∏–Ω–∏–º—É–º 20-50 —Å–≤–µ—á–µ–π –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–∞–∂–Ω–æ** ‚Äî —Ñ–∏–≥—É—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–±–æ—è
3. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ** ‚Äî —Ñ–∏–≥—É—Ä–∞ –Ω–∞ —Ñ–æ–Ω–µ —Å–∏–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–Ω–¥–∞ –Ω–∞–¥–µ–∂–Ω–µ–µ
4. **–¢–∞–π–º—Ñ—Ä–µ–π–º –≤–∞–∂–µ–Ω** ‚Äî —Ñ–∏–≥—É—Ä—ã –Ω–∞ 1h/4h –Ω–∞–¥–µ–∂–Ω–µ–µ, —á–µ–º –Ω–∞ 1m/5m
5. **–ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º –ª–æ–≥–∏–∫—É** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã (is_confirmed=True)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–°–∫–∞–ª—å–ø–∏–Ω–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã](https://livetouring.org/skalping-strategii-kriptovaljuty-s-primerami/)
- [Chart Patterns Guide](https://www.investopedia.com/trading/chart-patterns/)
- [Technical Analysis Patterns](https://www.tradingview.com/ideas/chartpattern/)

